language: python
python:
  - "2.7"
  - "3.6"

matrix:
  fast_finish: true

cache: pip

sudo: required
env:
  global:
    - secure: W6pM9s7ESkYPON+w5/9/m190f00YtGuTHM5jkqxnPVZnXkP7kmMD6e6r6UDdPuREHLnOASUPDuoTnY0JcQkQA6mV/L0gRLWnm5SB4HUN/5Rw0wSeViTbdZ9o2d7jvxl/R4/JXgXZbKWpJJOIzQI4eBSAoM4WBUG0PxHs7vhPuHMHvu2HcJ1+d+RXT4KJ/yXB5i3HCduLifQSgQsmeVTXRJhYiLeAWgNWG0rnqDrC/h5J9iaBNO55E+gk3vLvxG6KUp/kzMDkGHMSDmbdKdxCoTYrdllXMLRtlz3Cz95zhFmVrgevrb/aE1uesaMWwuHTTdHCYEO2NzkigIeLMy0LaJpAvfz0iJghZLjaMNlSqORikk9fD76LnEKX1H8sYO7bBajh27bUKAn9nX5XYqJD6TpIfbWopkbLp98AaRlSYayHa1co9zQJrh362VYmrgmCqdomXbroMpM6VXggCWGvI2PB/hD55dQ2De58Z2IZFjZOUPfI4hXmFpe3oQVLowGKCWoJeY5juN+CQBNf0zZ8ij8f8TdMk8NeMbIMbSGkedmxn0MzubQ/q5MpPFl32MzA6pMFfwK5ExFLOmGQHut6hgJcJ1mMZQLsddXAyz60zmw6riRqS1TLnfgyd5jvOLgGV/Yzkxc4vVd0w55i24Xgl+ENBYP9JTMRypJ96zgYjGM=
    - CIBW_ENVIRONMENT="PYPANDOC_PANDOC='/root/bin/pandoc'"
    - CIBW_BEFORE_BUILD="{python} ci_scripts/assimpDownload.py && {pip} install numpy && {pip} install cython && {python} setup.py build_ext --force"
    - CIBW_SKIP="cp33-*"
#    - CIBW_TEST_COMMAND="{python} -m unittest {project}/tests/test_simple"

services:
  - docker

addons:
  apt:
    packages:
      - libassimp3
      - libassimp-dev

before_install:
  - pip install -r ./requirements.txt

install:
  - python setup.py build_ext
  - python setup.py install

script:
  - pushd tests && python -m unittest test_simple && popd
  - python ci_scripts/buildLinuxWheels.py wheelhouse dist